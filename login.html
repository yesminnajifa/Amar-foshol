<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>লগইন / সাইনআপ — আমারফসল</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:SolaimanLipi, Noto Sans Bengali, sans-serif}
html,body{height:100%}
body{display:flex;align-items:center;justify-content:center;background:#f6fbf7;}
.container{width:100%;max-width:980px;background:white;border-radius:16px;box-shadow:0 20px 40px rgba(10,30,10,0.08);overflow:hidden;display:grid;grid-template-columns:1fr 1fr}
.hero{padding:48px;background:linear-gradient(135deg,#e6fbec 0%, #f9fff9 100%);position:relative}
.logo{display:flex;gap:12px;align-items:center;margin-bottom:16px}
.logo .mark{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,#2fa84b,#67d17a);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px}
.brand{font-weight:700;font-size:20px}
.tag{color:#4b6b4b;margin-top:6px}
.hero h1{font-size:22px;color:#0f5132;margin:18px 0;line-height:1.5}
.hero p{color:#276241;opacity:.9;line-height:1.45}
.forms{padding:36px}
.tabs{display:flex;gap:8px;margin-bottom:18px}
.tab{flex:1;padding:10px;border-radius:10px;text-align:center;cursor:pointer;border:1px solid transparent}
.tab.active{background:linear-gradient(90deg,#f0fff3,#fff);border:1px solid #e2f7dd;color:#0b4f2c;font-weight:600;box-shadow:0 6px 18px rgba(30,120,60,.06)}
form{display:grid;gap:12px}
label{font-size:14px;color:#235034}
input,select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #e6efe6;background:white;font-size:14px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.actions{display:flex;align-items:center;justify-content:space-between;margin-top:6px}
.btn{padding:10px 16px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
.btn.primary{background:linear-gradient(90deg,#2fa84b,#1f8a44);color:white}
.btn.ghost{background:transparent;border:1px solid #e6efe6}
.small{font-size:13px;color:#4b6b4b}
.captcha{ display: flex; align-items: center; gap: 6px; font-size: 13px; color: #4b6b4b; }
.captcha label{ margin:0; white-space: nowrap; }
#resetForm{display:none;}
#otpSection{display:none;}
#newPassSection{display:none;}
@media(max-width:880px){.container{grid-template-columns:1fr}.hero{display:none}}
</style>
</head>
<body>
<div class="container">
  <div class="hero">
    <div class="logo">
      <div class="mark"></div>
      <div>
        <div class="brand">আমারফসল</div>
        <div class="tag">কৃষকের নিজের গর্বের প্রতীক; পাশাপাশি ভোক্তাও ভাববে ‘আমাদের ফসল’।</div>
      </div>
    </div>
    <h1>কৃষকের পাশে — প্রযুক্তি ও ন্যায্য মূল্যের সেতুবন্ধন।</h1>
    <p>আমাদের IoT ডিভাইস ও মোবাইল অ্যাপ কৃষকের মাঠের তথ্য সরাসরি সংগ্রহ করে।</p>
  </div>

  <div class="forms">
    <div class="tabs">
      <div class="tab active" id="tab-login">লগইন</div>
      <div class="tab" id="tab-signup">সাইন আপ</div>
    </div>

    <!-- লগইন ফর্ম -->
    <form id="loginForm">
      <label>ইউজারনেম বা মোবাইল নম্বর</label>
      <input type="text" id="loginText" placeholder="০১XXXXXXXXX বা ইউজারনেম" required>

      <label>পাসওয়ার্ড</label>
      <input type="password" id="loginPass" placeholder="পাসওয়ার্ড দিন" required>

      <div class="captcha">
        <input type="checkbox" id="termsLogin" required>
        <label for="termsLogin">আমি সমস্ত শর্তাবলীতে সম্মত</label>
      </div>

      <div class="actions">
        <button class="btn ghost" type="button" id="resetPasswordBtn">পাসওয়ার্ড রিসেট করুন</button>
        <button class="btn primary" type="submit">লগইন</button>
      </div>
    </form>

    <!-- পাসওয়ার্ড রিসেট ফর্ম -->
    <form id="resetForm">
      <label>মোবাইল নম্বর দিন (যেভাবে সাইনআপ করেছিলেন)</label>
      <input type="tel" id="resetMobile" placeholder="০১XXXXXXXXX" required>

      <div class="actions">
        <button type="button" class="btn primary" id="sendOtpBtn">ওটিপি পাঠান</button>
        <button type="button" class="btn ghost" id="cancelResetBtn">বাতিল</button>
      </div>

      <div id="otpSection">
        <label>OTP দিন</label>
        <input type="text" id="otpInput" placeholder="৪ অঙ্কের OTP">

        <div class="actions">
          <button type="button" class="btn primary" id="verifyOtpBtn">OTP যাচাই</button>
        </div>
      </div>

      <div id="newPassSection">
        <label>নতুন পাসওয়ার্ড</label>
        <input type="password" id="newPassword" placeholder="নতুন পাসওয়ার্ড" >
        <label>নতুন পাসওয়ার্ড আবার দিন</label>
        <input type="password" id="newPasswordConfirm" placeholder="নতুন পাসওয়ার্ড আবার দিন" >

        <div class="actions">
          <button type="button" class="btn primary" id="submitNewPass">সাবমিট</button>
        </div>
      </div>
    </form>

    <!-- সাইনআপ ফর্ম (division-district থাকবে) -->
    <form id="signupForm" style="display:none;">
      <div class="row">
        <div>
          <label>প্রথম নাম</label>
          <input type="text" id="signupFirst" required>
        </div>
        <div>
          <label>শেষ নাম</label>
          <input type="text" id="signupLast" required>
        </div>
      </div>
      <label>ইউজারনেম</label>
      <input type="text" id="signupUser" required>
      <label>মোবাইল নম্বর</label>
      <input type="tel" id="signupMobile" placeholder="০১XXXXXXXXX" required>

      <label>বিভাগ</label>
      <select id="divisionSelect" required>
        <option value="">বিভাগ নির্বাচন করুন</option>
        <option value="ঢাকা">ঢাকা</option>
        <option value="চট্টগ্রাম">চট্টগ্রাম</option>
        <option value="রাজশাহী">রাজশাহী</option>
        <option value="খুলনা">খুলনা</option>
        <option value="বরিশাল">বরিশাল</option>
        <option value="সিলেট">সিলেট</option>
        <option value="রংপুর">রংপুর</option>
        <option value="ময়মনসিংহ">ময়মনসিংহ</option>
      </select>

      <label>জেলা</label>
      <select id="districtSelect" required disabled>
        <option>প্রথমে বিভাগ নির্বাচন করুন</option>
      </select>

      <div class="captcha">
        <input id="termsSignup" type="checkbox" required>
        <label for="termsSignup">আমি সমস্ত শর্তাবলীতে সম্মত</label>
      </div>

      <div class="actions">
        <button class="btn primary" type="submit">জমা দিন</button>
      </div>
    </form>

  </div>
</div>

<script>
// ---------- ট্যাব কন্ট্রোল ----------
const tabLogin=document.getElementById('tab-login');
const tabSignup=document.getElementById('tab-signup');
const loginForm=document.getElementById('loginForm');
const signupForm=document.getElementById('signupForm');
const resetForm=document.getElementById('resetForm');

tabLogin.onclick=()=>{
  tabLogin.classList.add('active');
  tabSignup.classList.remove('active');
  loginForm.style.display='grid';
  signupForm.style.display='none';
  resetForm.style.display='none';
};
tabSignup.onclick=()=>{
  tabSignup.classList.add('active');
  tabLogin.classList.remove('active');
  signupForm.style.display='grid';
  loginForm.style.display='none';
  resetForm.style.display='none';
};

// ---------- Division -> District dynamic ----------
const divisions = {
  "ঢাকা": ["ঢাকা","গাজীপুর","নারায়ণগঞ্জ","নরসিংদী","ফরিদপুর","গোপালগঞ্জ","মাদারীপুর","মানিকগঞ্জ","মুন্সিগঞ্জ","রাজবাড়ী","শরীয়তপুর","টাঙ্গাইল","কিশোরগঞ্জ"],
  "চট্টগ্রাম": ["চট্টগ্রাম","কক্সবাজার","বান্দরবান","রাঙ্গামাটি","খাগড়াছড়ি","ফেনী","নোয়াখালী","লক্ষ্মীপুর","চাঁদপুর","ব্রাহ্মণবাড়িয়া","কুমিল্লা"],
  "রাজশাহী": ["রাজশাহী","নাটোর","চাঁপাইনবাবগঞ্জ","নওগাঁ","জয়পুরহাট","বগুড়া","পাবনা","সিরাজগঞ্জ"],
  "খুলনা": ["খুলনা","বাগেরহাট","সাতক্ষীরা","যশোর","ঝিনাইদহ","মাগুরা","নড়াইল","চুয়াডাঙ্গা","কুষ্টিয়া","মেহেরপুর"],
  "বরিশাল": ["বরিশাল","পটুয়াখালী","ভোলা","ঝালকাঠি","পিরোজপুর","বরগুনা"],
  "সিলেট": ["সিলেট","মৌলভীবাজার","হবিগঞ্জ","সুনামগঞ্জ"],
  "রংপুর": ["রংপুর","দিনাজপুর","গাইবান্ধা","নীলফামারী","কুড়িগ্রাম","লালমনিরহাট","ঠাকুরগাঁও","পঞ্চগড়"],
  "ময়মনসিংহ": ["ময়মনসিংহ","নেত্রকোনা","শেরপুর","জামালপুর"]
};
const divisionSelect = document.getElementById('divisionSelect');
const districtSelect = document.getElementById('districtSelect');
divisionSelect.addEventListener('change',()=>{
  const sel = divisionSelect.value;
  districtSelect.innerHTML = "";
  if(sel && divisions[sel]){
    districtSelect.disabled=false;
    districtSelect.innerHTML = '<option value="">জেলা নির্বাচন করুন</option>'+divisions[sel].map(d=>`<option value="${d}">${d}</option>`).join('');
  }else{
    districtSelect.disabled=true;
    districtSelect.innerHTML='<option>প্রথমে বিভাগ নির্বাচন করুন</option>';
  }
});

// ---------- SIGNUP ----------
const signupFormEl = document.getElementById("signupForm");
signupFormEl.addEventListener("submit", (e) => {
  e.preventDefault();

  const userData = {
    firstName: document.getElementById("signupFirst").value.trim(),
    lastName: document.getElementById("signupLast").value.trim(),
    username: document.getElementById("signupUser").value.trim(),
    mobile: document.getElementById("signupMobile").value.trim(),
    division: divisionSelect.value,
    district: districtSelect.value,
    password: prompt("একটি পাসওয়ার্ড দিন (মনে রাখবেন):")
  };

  if (!userData.password) {
    alert("পাসওয়ার্ড না দিলে সাইনআপ সম্পূর্ণ হবে না!");
    return;
  }

  localStorage.setItem("userData", JSON.stringify(userData));
  alert("সাইনআপ সফল হয়েছে! এখন লগইন করুন।");

  signupFormEl.style.display = "none";
  loginForm.style.display = "grid";
  tabLogin.classList.add("active");
  tabSignup.classList.remove("active");
});

// ---------- LOGIN ----------
const loginFormEl = document.getElementById("loginForm");
loginFormEl.addEventListener("submit", (e) => {
  e.preventDefault();

  const loginText = document.getElementById("loginText").value.trim();
  const loginPass = document.getElementById("loginPass").value.trim();
  const savedUser = JSON.parse(localStorage.getItem("userData"));

  if (!savedUser) {
    alert("কোনও সাইনআপ করা ব্যবহারকারী নেই!");
    return;
  }

  if ((loginText === savedUser.username || loginText === savedUser.mobile) && loginPass === savedUser.password) {
    alert("লগইন সফল! আপনাকে মূল পেজে নিয়ে যাওয়া হচ্ছে...");
    window.location.href = "index.html";
  } else {
    alert("ইউজারনেম/মোবাইল বা পাসওয়ার্ড ভুল!");
  }
});

// ---------- PASSWORD RESET FLOW ----------
const resetBtn = document.getElementById('resetPasswordBtn');
const sendOtpBtn = document.getElementById('sendOtpBtn');
const cancelResetBtn = document.getElementById('cancelResetBtn');
const otpSection = document.getElementById('otpSection');
const otpInput = document.getElementById('otpInput');
const verifyOtpBtn = document.getElementById('verifyOtpBtn');
const newPassSection = document.getElementById('newPassSection');
const newPasswordInput = document.getElementById('newPassword');
const newPasswordConfirm = document.getElementById('newPasswordConfirm');
const submitNewPassBtn = document.getElementById('submitNewPass');

let generatedOTP = null;
let otpTimer = null;

resetBtn.addEventListener('click', () => {
  // hide other forms, show reset form
  loginForm.style.display = 'none';
  signupForm.style.display = 'none';
  resetForm.style.display = 'grid';
  otpSection.style.display = 'none';
  newPassSection.style.display = 'none';
  generatedOTP = null;
  if (otpTimer) { clearTimeout(otpTimer); otpTimer = null; }
});

cancelResetBtn.addEventListener('click', () => {
  resetForm.style.display = 'none';
  loginForm.style.display = 'grid';
});

// send OTP
sendOtpBtn.addEventListener('click', () => {
  const enteredMobile = document.getElementById('resetMobile').value.trim();
  const savedUser = JSON.parse(localStorage.getItem("userData"));

  if (!savedUser) {
    alert('কোনও সাইনআপ করা ব্যবহারকারী নেই!');
    return;
  }
  if (!enteredMobile) {
    alert('মোবাইল নম্বর দিন।');
    return;
  }
  if (enteredMobile !== savedUser.mobile) {
    alert('প্রদানকৃত মোবাইল নম্বর সাইনআপ মোবাইলের সাথে মেলে না।');
    return;
  }

  // Generate 4-digit OTP and show (since no SMS service)
  generatedOTP = Math.floor(1000 + Math.random() * 9000).toString();
  alert('আপনার OTP: ' + generatedOTP + '\n(দেখানোর জন্য browser alert ব্যবহার করা হয়েছে।)');

  // show OTP input
  otpSection.style.display = 'grid';
  newPassSection.style.display = 'none';
  otpInput.value = '';

  // optional: OTP expires after 5 minutes
  if (otpTimer) clearTimeout(otpTimer);
  otpTimer = setTimeout(()=> { generatedOTP = null; }, 5*60*1000);
});

// verify OTP
verifyOtpBtn.addEventListener('click', () => {
  const entered = otpInput.value.trim();
  if (!generatedOTP) {
    alert('OTP মেয়াদোত্তীর্ণ বা পাঠানো হয়নি। আবার ওটিপি পাঠান।');
    return;
  }
  if (entered === generatedOTP) {
    alert('OTP যাচাই সফল। এখন নতুন পাসওয়ার্ড দিন।');
    newPassSection.style.display = 'grid';
    otpSection.style.display = 'none';
  } else {
    alert('ভুল OTP। আবার চেক করুন।');
  }
});

// submit new password
submitNewPassBtn.addEventListener('click', () => {
  const p1 = newPasswordInput.value;
  const p2 = newPasswordConfirm.value;
  if (!p1 || !p2) {
    alert('নতুন পাসওয়ার্ড দুইবারই দিন।');
    return;
  }
  if (p1 !== p2) {
    alert('পাসওয়ার্ড মিলছে না। একই পাসওয়ার্ড দিন।');
    return;
  }
  // update user in localStorage
  const savedUser = JSON.parse(localStorage.getItem("userData"));
  if (!savedUser) {
    alert('কোনও সাইনআপ করা ব্যবহারকারী নেই!');
    return;
  }
  savedUser.password = p1;
  localStorage.setItem("userData", JSON.stringify(savedUser));
  alert('পাসওয়ার্ড সফলভাবে আপডেট হয়েছে। লগইন ফর্মে ফিরে যাওয়া হচ্ছে।');

  // reset UI
  generatedOTP = null;
  if (otpTimer) { clearTimeout(otpTimer); otpTimer = null; }
  newPasswordInput.value = '';
  newPasswordConfirm.value = '';
  document.getElementById('resetMobile').value = '';
  resetForm.style.display = 'none';
  loginForm.style.display = 'grid';
});
</script>
</body>
</html>
